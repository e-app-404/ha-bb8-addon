{
  "$schema": "http://json-schema.org/hestia_v7/schema#",
  "title": "HESTIA Unified Device Registry Schema",
  "description": "Schema for all devices (lights, sensors) with multi-protocol support in the HESTIA smart home system",
  "version": "1.0.0",
  "generated_at": "2025-05-02T00:30:25.371625Z",
  "type": "object",
  "compatibility": ["alpha_light_regsitry.json", "alpha_sensor_registry.json", ""],
  "required": ["_meta"],
  "properties": {
    "_meta": {
      "type": "object",
      "description": "Metadata about the registry file",
      "required": ["schema_version", "last_updated"],
      "properties": {
        "schema_version": {
          "type": "string",
          "description": "Version of the registry schema"
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "When the registry was last updated"
        },
        "schema_notes": {
          "type": "string",
          "description": "Notes about schema validation"
        },
        "build_date": {
          "type": "string",
          "format": "date-time",
          "description": "When the registry was built"
        },
        "build_by": {
          "type": "string",
          "description": "Entity that built the registry"
        },
        "schema": {
          "type": "string",
          "description": "Schema reference"
        },
        "version": {
          "type": "string",
          "description": "Version of the registry"
        },
        "validation_status": {
          "type": "object",
          "properties": {
            "status": {
              "type": "string",
              "enum": ["valid", "warning", "invalid", "pending", "rebuilding"],
              "description": "Current validation status"
            },
            "validated_by": {
              "type": ["string", "null"],
              "description": "Entity or system that performed validation"
            },
            "timestamp": {
              "type": ["string", "null"],
              "format": "date-time",
              "description": "When the registry was last validated"
            }
          }
        }
      }
    },
    "protocol_definitions": {
      "type": "object",
      "description": "Definitions of supported communication protocols",
      "patternProperties": {
        "^[a-z0-9_]+$": {
          "type": "object",
          "required": ["name", "description", "priority"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Protocol name"
            },
            "description": {
              "type": "string",
              "description": "Protocol description"
            },
            "priority": {
              "type": "integer",
              "description": "Default priority for this protocol (lower is higher priority)"
            }
          }
        }
      }
    },
    "integration_platforms": {
      "type": "object",
      "description": "Definitions of supported integration platforms",
      "patternProperties": {
        "^[a-z0-9_]+$": {
          "type": "object",
          "required": ["name", "description", "protocol"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Integration platform name"
            },
            "alias": {
              "type": ["string", "null"],
              "description": "Alternative name for the platform"
            },
            "description": {
              "type": "string",
              "description": "Platform description"
            },
            "protocol": {
              "oneOf": [
                { "type": "string" },
                {
                  "type": "array",
                  "items": { "type": "string" }
                }
              ],
              "description": "Communication protocol(s) used by this platform"
            },
            "priority": {
              "type": "integer",
              "description": "Default priority for this platform (lower is higher priority)"
            }
          }
        }
      }
    },
    "devices": {
      "type": "object",
      "description": "Registry of all sensor devices using alpha naming pattern",
      "patternProperties": {
        "^[a-z0-9_]+_α$": {
          "type": "object",
          "required": [
            "metadata",
            "location",
            "device_info",
            "integration"
          ],
          "properties": {
            "metadata": {
              "type": "object",
              "required": [
                "alpha_name",
                "friendly_name",
                "internal_name",
                "alpha_canonical"
              ],
              "properties": {
                "alpha_name": { "type": "string" },
                "friendly_name": { "type": "string" },
                "internal_name": { "type": "string" },
                "alpha_canonical": { "type": "string", "pattern": "_α$" },
                "added_date": { "type": "string", "format": "date" },
                "omega_name": { "type": "string" },
                "canonical_id": { "type": "string" },
                "type": {
                  "type": "string",
                  "enum": ["light", "switch", "lightstrip", "sensor", "binary_sensor", "climate", "cover", "media_player"]
                }
              }
            },
            "location": {
              "type": "object",
              "required": ["room", "role"],
              "properties": {
                "room": { "type": "string" },
                "area": { "type": ["string", "null"] },
                "role": { "type": "string" },
                "signal_type": { "type": ["string", "null"] },
                "signal": { "type": ["string", "null"] },
                "area_id": { "type": "string" },
                "room_area": { "type": ["string", "null"] }
              }
            },
            "device_info": {
              "type": "object",
              "properties": {
                "manufacturer": { "type": ["string", "null"] },
                "model": { "type": ["string", "null"] },
                "model_name": { "type": ["string", "null"] },
                "firmware": { "type": ["string", "null"] },
                "mac": { "type": ["string", "null"] },
                "ipv4": { "type": ["string", "null"] },
                "ipv6": { "type": ["string", "null"] },
                "ssid": { "type": ["string", "null"] },
                "connected_via": {
                  "type": ["array", "null"],
                  "items": {
                    "type": "object",
                    "properties": {
                      "device_id": { "type": "string" },
                      "device_name": { "type": "string" },
                      "integration": { "type": "string" },
                      "mac": { "type": ["string", "null"] }
                    }
                  }
                },
                "entities": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "entity": { "type": "string" },
                      "entity_id": { "type": "string" },
                      "name": { "type": "string" },
                      "canonical_id": { "type": "string" },
                      "type": { "type": "string" },
                      "state": { "type": ["string", "number", "null"] },
                      "domain": { "type": ["string", "null"] },
                      "friendly_name": { "type": ["string", "null"] },
                      "select_options": {
                        "type": "array",
                        "items": { "type": "string" }
                      }
                    }
                  }
                },
                "history": {
                  "type": "object",
                  "properties": {
                    "added": { "type": "string", "format": "date" },
                    "protocol_switches": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "timestamp": { "type": "string", "format": "date-time" },
                          "from": { "type": "string" },
                          "to": { "type": "string" },
                          "reason": { "type": "string" }
                        }
                      }
                    }
                  }
                },
                "mqtt_bindings": {
                  "type": "object",
                  "properties": {
                    "command_topic": { "type": "string" },
                    "state_topic": { "type": "string" },
                    "availability_topic": { "type": "string" },
                    "json_template": { "type": "object" },
                    "publish_template": { "type": "object" },
                    "schema": { "type": "string" },
                    "brightness_scale": { "type": "integer" },
                    "supported_color_modes": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "effect_list": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                }
              }
            },
            "integration": {
              "type": "object",
              "required": ["preferred_protocol"],
              "properties": {
                "preferred_protocol": { "type": "string" },
                "integration_stack": {
                  "type": "object",
                  "patternProperties": {
                    "^[a-z0-9_]+$": {
                      "type": "object",
                      "properties": {
                        "device_id": { "type": "string" },
                        "protocol": { "type": "string" },
                        "origin": { "type": "string" },
                        "type": { "type": "string" },
                        "class": { "type": ["string", "object"] },
                        "signal_type": { "type": ["string", "null"] },
                        "entity_id": { "type": "string" },
                        "canonical_id": { "type": "string" },
                        "status": {
                          "type": "string",
                          "enum": ["paired", "unpaired", "fallback", "disabled", "unreliable", "discovering", "failed"]
                        },
                        "platform": { "type": "string" },
                        "device_class": { "type": "string" },
                        "availability_sensor": { "type": ["string", "null"] },
                        "mqtt_topic": { "type": ["string", "null"] }
                      }
                    }
                  }
                },
                "protocol_metrics": {
                  "type": "object",
                  "patternProperties": {
                    "^[a-z0-9_]+$": {
                      "type": "object",
                      "properties": {
                        "last_seen": { "type": ["string", "null"], "format": "date-time" },
                        "response_time_ms": { "type": ["number", "null"], "minimum": 0 },
                        "reliability_score": { "type": ["number", "null"], "minimum": 0, "maximum": 100 }
                      }
                    }
                  }
                },
                "fallback_settings": {
                  "type": "object",
                  "properties": {
                    "retry_attempts": { "type": "integer", "minimum": 0 },
                    "retry_delay_ms": { "type": "integer", "minimum": 0 },
                    "auto_switch_threshold": { "type": "integer", "minimum": 0 },
                    "return_to_preferred_after": { "type": "integer", "minimum": 0 }
                  }
                }
              }
            },
            "capabilities": {
              "oneOf": [
                {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": [
                      "entity",
                      "entity_id",
                      "name",
                      "canonical_id",
                      "type"
                    ],
                    "properties": {
                      "entity": { "type": "string" },
                      "entity_id": { "type": "string" },
                      "name": { "type": "string" },
                      "canonical_id": { "type": "string" },
                      "type": { "type": "string" },
                      "mqtt_topic": { "type": ["string", "null"] },
                      "state": { "type": ["string", "null"] },
                      "domain": { "type": ["string", "null"] }
                    }
                  }
                },
                {
                  "type": "object",
                  "properties": {
                    "brightness": { "type": ["boolean", "null"] },
                    "color_temp": { "type": ["boolean", "null"] },
                    "color": { "type": ["boolean", "null"] },
                    "effects": { "type": ["boolean", "null"] }
                  }
                }
              ]
            },
            "features": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "entity": { "type": "string" },
                  "entity_id": { "type": "string" },
                  "name": { "type": "string" },
                  "canonical_id": { "type": "string" },
                  "type": { "type": "string" },
                  "mqtt_topic": { "type": ["string", "null"] },
                  "state": { "type": ["string", "null"] },
                  "domain": { "type": ["string", "null"] }
                }
              }
            },
            "change_history": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["timestamp", "modified_by", "changes"],
                "properties": {
                  "timestamp": { "type": "string", "format": "date-time" },
                  "modified_by": { "type": "string" },
                  "changes": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": ["field", "old_value", "new_value", "reason"],
                      "properties": {
                        "field": { "type": "string" },
                        "old_value": { "type": ["string", "number", "boolean", "null", "object"] },
                        "new_value": { "type": ["string", "number", "boolean", "null", "object"] },
                        "reason": { "type": "string" }
                      }
                    }
                  }
                }
              }
            },
            "history": {
              "type": "object",
              "properties": {
                "added": { "type": "string", "format": "date" },
                "protocol_switches": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "timestamp": { "type": "string", "format": "date-time" },
                      "from": { "type": "string" },
                      "to": { "type": "string" },
                      "reason": { "type": "string" }
                    }
                  }
                }
              }
            },
            "confidence_metrics": {
              "type": "object",
              "properties": {
                "entity_confidence": {
                  "type": "object",
                  "properties": {
                    "score": { "type": "integer", "minimum": 0, "maximum": 100 },
                    "factors": { "type": "array", "items": { "type": "string" } },
                    "uncertain_fields": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                },
                "device_confidence": {
                  "type": "object",
                  "properties": {
                    "score": { "type": "integer", "minimum": 0, "maximum": 100 },
                    "factors": { "type": "array", "items": { "type": "string" } },
                    "uncertain_fields": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                },
                "relationship_confidence": {
                  "type": "object",
                  "properties": {
                    "score": { "type": "integer", "minimum": 0, "maximum": 100 },
                    "factors": { "type": "array", "items": { "type": "string" } },
                    "uncertain_fields": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                },
                "requires_review": { "type": "boolean" },
                "last_validation": { "type": "string", "format": "date-time" },
                "validated_by": { "type": "string" }
              }
            },
            "status": {
              "type": ["string", "null"],
              "enum": ["available", "unavailable", "degraded", null],
              "description": "Current device status"
            },
            "error_reason": {
              "type": ["string", "null"],
              "description": "Reason for error state if applicable"
            },
            "device_id": {
              "type": ["string", "null"],
              "description": "Unique device identifier"
            },
            "alpha_name": {
              "type": ["string", "null"],
              "description": "Legacy alpha name for backward compatibility"
            }
            },
            "fallback_settings": {
              "type": "object",
              "properties": {
                "retry_attempts": { "type": "integer", "minimum": 0 },
                "retry_delay_ms": { "type": "integer", "minimum": 0 },
                "auto_switch_threshold": { "type": "integer", "minimum": 0 },
                "return_to_preferred_after": { "type": "integer", "minimum": 0 }
              }
            },
            "protocol_metrics": {
              "type": "object"
            },
            "status": {
              "type": ["string", "null"],
              "enum": ["available", "unavailable", "degraded", null]
            },
            "error_reason": {
              "type": ["string", "null"]
            }
          }
        }
      }
    },
    "light_devices": {
      "type": "object",
      "description": "Registry of all light devices using omega naming pattern",
      "patternProperties": {
        "^[a-z0-9_]+_omega$": {
          "type": "object",
          "required": [
            "omega_name", "friendly_name", "canonical_id", "type",
            "location", "area_id", "integration_stack",
            "preferred_protocol", "capabilities", "device_info"
          ],
          "properties": {
            "omega_name": {
              "type": "string",
              "description": "System name for the device omega"
            },
            "friendly_name": {
              "type": "string",
              "description": "Human-friendly name displayed in UI"
            },
            "internal_name": {
              "type": ["string", "null"],
              "description": "Internal system identifier"
            },
            "canonical_id": {
              "type": "string",
              "description": "Unique canonical identifier with omega symbol",
              "pattern": "^[a-z0-9_]+_ω$"
            },
            "type": {
              "type": "string",
              "enum": ["light", "switch", "lightstrip"],
              "description": "Device type"
            },
            "location": {
              "type": "object",
              "required": ["room"],
              "properties": {
                "room": {
                  "type": "string",
                  "description": "Room identifier"
                },
                "area": {
                  "type": ["string", "null"],
                  "description": "Area within room"
                },
                "role": {
                  "type": ["string", "null"],
                  "description": "Functional role in the area"
                }
              }
            },
            "area_id": {
              "type": "string",
              "description": "Reference to room registry ID"
            },
            "room_area": {
              "type": ["string", "null"],
              "description": "Reference to area within room"
            },
            "integration_stack": {
              "type": "object",
              "description": "Available integration protocols",
              "minProperties": 1,
              "patternProperties": {
                "^[a-z0-9_]+$": {
                  "type": "object",
                  "required": [
                    "protocol", "type", "canonical_id",
                    "status", "availability_sensor"
                  ],
                  "properties": {
                    "protocol": {
                      "type": "string",
                      "description": "Communication protocol"
                    },
                    "device_id": {
                      "type": ["string", "null"],
                      "description": "Protocol-specific device ID"
                    },
                    "type": {
                      "type": "string",
                      "description": "Device type within protocol"
                    },
                    "entity_id": {
                      "type": ["string", "null"],
                      "description": "Primary entity ID"
                    },
                    "origin": {
                      "type": ["string", "null"],
                      "description": "Original entity for this integration"
                    },
                    "canonical_id": {
                      "type": "string",
                      "description": "Canonical alpha ID for protocol",
                      "pattern": "^[a-z0-9_]+_α(_[a-z0-9_]+)?$"
                    },
                    "status": {
                      "type": "string",
                      "enum": ["paired", "unpaired", "discovering", "failed", "fallback"],
                      "description": "Current pairing status"
                    },
                    "availability_sensor": {
                      "type": "string",
                      "description": "Entity ID for availability sensing"
                    },
                    "class": { "type": ["string", "object"] },
                    "signal_type": { "type": ["string", "null"] },
                    "platform": { "type": "string" },
                    "device_class": { "type": "string" },
                    "mqtt_topic": { "type": ["string", "null"] }
                  }
                }
              }
            },
            "preferred_protocol": {
              "type": "string",
              "description": "Primary protocol to use"
            },
            "protocol_metrics": {
              "type": "object",
              "description": "Performance metrics for each protocol",
              "patternProperties": {
                "^[a-z0-9_]+$": {
                  "type": "object",
                  "properties": {
                    "last_seen": {
                      "type": ["string", "null"],
                      "format": "date-time",
                      "description": "Last time device was seen via this protocol"
                    },
                    "response_time_ms": {
                      "type": ["number", "null"],
                      "description": "Average response time in milliseconds"
                    },
                    "reliability_score": {
                      "type": ["number", "null"],
                      "minimum": 0,
                      "maximum": 100,
                      "description": "Reliability score 0-100"
                    }
                  }
                }
              }
            },
            "fallback_settings": {
              "type": "object",
              "properties": {
                "retry_attempts": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Number of retry attempts"
                },
                "retry_delay_ms": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Delay between retries in milliseconds"
                },
                "auto_switch_threshold": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Failed attempts before switching protocols"
                },
                "return_to_preferred_after": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Seconds until returning to preferred protocol"
                }
              }
            },
            "capabilities": {
              "type": "object",
              "properties": {
                "brightness": { "type": ["boolean", "null"] },
                "color_temp": { "type": ["boolean", "null"] },
                "color": { "type": ["boolean", "null"] },
                "effects": { "type": ["boolean", "null"] }
              }
            },
            "device_info": {
              "type": "object",
              "properties": {
                "manufacturer": {
                  "type": ["string", "null"],
                  "description": "Device manufacturer"
                },
                "model": {
                  "type": ["string", "null"],
                  "description": "Model number/code"
                },
                "model_name": {
                  "type": ["string", "null"],
                  "description": "Human-readable model name"
                },
                "firmware": {
                  "type": ["string", "null"],
                  "description": "Current firmware version"
                },
                "mac": {
                  "type": ["string", "null"],
                  "description": "MAC address"
                },
                "ipv4": {
                  "type": ["string", "null"],
                  "description": "IPv4 address if applicable"
                },
                "ipv6": {
                  "type": ["string", "null"],
                  "description": "IPv6 address if applicable"
                },
                "ssid": {
                  "type": ["string", "null"],
                  "description": "WiFi network name if applicable"
                },
                "mqtt_bindings": {
                  "type": "object",
                  "description": "MQTT topic and template bindings for MQTT devices",
                  "properties": {
                    "command_topic": { "type": "string" },
                    "state_topic": { "type": "string" },
                    "availability_topic": { "type": "string" },
                    "json_template": { "type": "object" },
                    "publish_template": { "type": "object" },
                    "schema": { "type": "string" },
                    "brightness_scale": { "type": "integer" },
                    "supported_color_modes": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "effect_list": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                },
                "entities": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "entity": {
                        "type": "string",
                        "description": "Entity function/purpose"
                      },
                      "entity_id": {
                        "type": "string",
                        "description": "Unique entity identifier"
                      },
                      "name": {
                        "type": "string",
                        "description": "Friendly entity name"
                      },
                      "canonical_id": {
                        "type": "string",
                        "description": "Canonical entity ID with alpha symbol",
                        "pattern": "^[a-z0-9_]+_α(_[a-z0-9_]+)?$"
                      },
                      "type": {
                        "type": "string",
                        "description": "Entity type"
                      },
                      "select_options": {
                        "type": "array",
                        "items": { "type": "string" },
                        "description": "Options for select entity types"
                      },
                      "state": {
                        "type": ["string", "number", "null"],
                        "description": "Current state of the entity"
                      },
                      "domain": {
                        "type": ["string", "null"],
                        "description": "Entity domain"
                      },
                      "friendly_name": {
                        "type": ["string", "null"],
                        "description": "Human-friendly name of the entity"
                      }
                    }
                  }
                },
                "history": {
                  "type": "object",
                  "properties": {
                    "added": {
                      "type": "string",
                      "format": "date",
                      "description": "Date device was added to system"
                    },
                    "protocol_switches": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "timestamp": {
                            "type": "string",
                            "format": "date-time",
                            "description": "When switch occurred"
                          },
                          "from": {
                            "type": "string",
                            "description": "Original protocol"
                          },
                          "to": {
                            "type": "string",
                            "description": "New protocol"
                          },
                          "reason": {
                            "type": "string",
                            "description": "Reason for protocol switch"
                          }
                        }
                      }
                    }
                  }
                },
                "connected_via": {
                  "type": ["array", "null"],
                  "items": {
                    "type": "object",
                    "properties": {
                      "device_id": { "type": "string" },
                      "device_name": { "type": "string" },
                      "integration": { "type": "string" },
                      "mac": { "type": ["string", "null"] }
                    }
                  }
                }
              }
            },
            "confidence_metrics": {
              "type": "object",
              "properties": {
                "entity_confidence": {
                  "type": "object",
                  "properties": {
                    "score": { "type": "integer", "minimum": 0, "maximum": 100 },
                    "factors": { "type": "array", "items": { "type": "string" } },
                    "uncertain_fields": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                },
                "device_confidence": {
                  "type": "object",
                  "properties": {
                    "score": { "type": "integer", "minimum": 0, "maximum": 100 },
                    "factors": { "type": "array", "items": { "type": "string" } },
                    "uncertain_fields": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                },
                "relationship_confidence": {
                  "type": "object",
                  "properties": {
                    "score": { "type": "integer", "minimum": 0, "maximum": 100 },
                    "factors": { "type": "array", "items": { "type": "string" } },
                    "uncertain_fields": {
                      "type": "array",
                      "items": { "type": "string" }
                    }
                  }
                },
                "requires_review": { "type": "boolean" },
                "last_validation": { "type": "string", "format": "date-time" },
                "validated_by": { "type": "string" }
              }
