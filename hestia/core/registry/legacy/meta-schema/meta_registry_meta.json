{
    "$schema": "http://json-schema.org/hestia-v7/schema#",
    "title": "registry_meta.json Meta-Schema",
    "name": "HESTIA Meta-Registry Schema Structure",
    "description": "Schema for registry metadata that tracks and manages all registry files in the HESTIA system",
    "type": "object",
    "required": ["_meta", "registries", "registry_stats", "health_metrics"],
    "properties": {
      "_meta": {
        "type": "object",
        "required": ["version", "last_updated", "system_id"],
        "properties": {
          "version": { 
            "type": "string",
            "description": "Version of the registry metadata schema",
            "example": "2.1.0"
          },
          "last_updated": { 
            "type": "string", 
            "format": "date-time",
            "description": "When this metadata was last updated",
            "example": "2025-04-29T08:00:00Z"
          },
          "system_id": { 
            "type": "string",
            "description": "Unique identifier for this HESTIA instance",
            "example": "hestia-main-278f4e"
          },
          "registry_root": {
            "type": "string",
            "description": "Base directory for all registry files",
            "example": "/config/hestia/core/registry/"
          },
          "initialized_at": {
            "type": "string",
            "format": "date-time",
            "description": "When the registry system was first initialized",
            "example": "2025-01-15T12:00:00Z"
          }
        }
      },
      "registries": {
        "type": "object",
        "description": "Metadata for all known registry files",
        "patternProperties": {
          "^[a-z0-9_]+\\.json$": {
            "type": "object",
            "required": ["file_path", "schema_path", "status", "last_modified"],
            "properties": {
              "file_path": {
                "type": "string",
                "description": "Path to the registry file",
                "example": "/config/hestia/core/registry/alpha_device_registry.json"
              },
              "schema_path": {
                "type": "string",
                "description": "Path to the schema file",
                "example": "/config/hestia/core/schemas/alpha_device_registry_schema.json"
              },
              "status": {
                "type": "string",
                "enum": ["valid", "warning", "invalid", "rebuilding", "locked"],
                "description": "Current status of this registry",
                "example": "valid"
              },
              "last_modified": {
                "type": "string",
                "format": "date-time",
                "description": "When this registry was last modified",
                "example": "2025-04-28T15:30:45Z"
              },
              "last_validated": {
                "type": "string",
                "format": "date-time",
                "description": "When this registry was last validated",
                "example": "2025-04-28T15:35:10Z"
              },
              "validation_result": {
                "type": "string",
                "enum": ["pass", "warning", "fail"],
                "description": "Result of last validation",
                "example": "pass"
              },
              "schema_version": {
                "type": "string",
                "description": "Version of schema used by this registry",
                "example": "1.2.0"
              },
              "entry_count": {
                "type": "integer",
                "description": "Number of entries in the registry",
                "example": 143
              },
              "file_size": {
                "type": "integer",
                "description": "Size of registry file in bytes",
                "example": 256780
              },
              "checksum": {
                "type": "string",
                "description": "SHA-256 checksum of the registry file",
                "example": "8a7b664ef265fafe8391aa91abc23def..."
              },
              "backup_status": {
                "type": "object",
                "description": "Backup information for this registry",
                "properties": {
                  "last_backup": {
                    "type": "string",
                    "format": "date-time",
                    "description": "When registry was last backed up",
                    "example": "2025-04-28T00:00:00Z"
                  },
                  "backup_location": {
                    "type": "string",
                    "description": "Where backups are stored",
                    "example": "/config/hestia/backups/registry/"
                  },
                  "versions_kept": {
                    "type": "integer",
                    "description": "Number of backup versions retained",
                    "example": 7
                  }
                }
              },
              "access_locks": {
                "type": "array",
                "description": "Active access locks on this registry",
                "items": {
                  "type": "object",
                  "properties": {
                    "lock_id": {
                      "type": "string",
                      "description": "Unique lock identifier",
                      "example": "maintenance-2025-04-29-001"
                    },
                    "locked_by": {
                      "type": "string",
                      "description": "Process that holds the lock",
                      "example": "MetaStructor-Rebuild"
                    },
                    "acquired_at": {
                      "type": "string",
                      "format": "date-time",
                      "description": "When the lock was acquired",
                      "example": "2025-04-29T08:15:00Z"
                    },
                    "expires_at": {
                      "type": "string",
                      "format": "date-time",
                      "description": "When the lock expires",
                      "example": "2025-04-29T08:45:00Z"
                    },
                    "lock_type": {
                      "type": "string",
                      "enum": ["read", "write", "exclusive"],
                      "description": "Type of lock held",
                      "example": "write"
                    }
                  }
                }
              },
              "dependencies": {
                "type": "array",
                "description": "Registries this registry depends on",
                "items": {
                  "type": "string",
                  "example": "alpha_device_registry.json"
                }
              },
              "dependents": {
                "type": "array",
                "description": "Registries that depend on this registry",
                "items": {
                  "type": "string",
                  "example": "beta_entity_registry.json"
                }
              },
              "refresh_frequency": {
                "type": "string",
                "description": "How often this registry is refreshed",
                "example": "daily"
              },
              "error_count": {
                "type": "integer",
                "description": "Current number of validation errors",
                "example": 0
              },
              "warning_count": {
                "type": "integer",
                "description": "Current number of validation warnings",
                "example": 2
              },
              "change_history": {
                "type": "array",
                "description": "Recent history of registry changes",
                "items": {
                  "type": "object",
                  "properties": {
                    "timestamp": {
                      "type": "string",
                      "format": "date-time",
                      "description": "When change occurred",
                      "example": "2025-04-28T14:22:35Z"
                    },
                    "type": {
                      "type": "string",
                      "enum": ["create", "update", "delete", "rebuild", "migrate"],
                      "description": "Type of change",
                      "example": "update"
                    },
                    "entries_affected": {
                      "type": "integer",
                      "description": "Number of entries affected",
                      "example": 3
                    },
                    "changed_by": {
                      "type": "string",
                      "description": "Component that made the change",
                      "example": "MetaStructor"
                    },
                    "description": {
                      "type": "string",
                      "description": "Human-readable change description",
                      "example": "Updated firmware versions for 3 devices"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "registry_stats": {
        "type": "object",
        "description": "Statistics about registry system usage",
        "properties": {
          "total_registries": {
            "type": "integer",
            "description": "Total number of registry files",
            "example": 14
          },
          "total_size_bytes": {
            "type": "integer",
            "description": "Total size of all registry files",
            "example": 4562340
          },
          "total_entries": {
            "type": "integer",
            "description": "Total number of entries across all registries",
            "example": 1432
          },
          "largest_registry": {
            "type": "string",
            "description": "Name of the largest registry file",
            "example": "alpha_device_registry.json"
          },
          "most_accessed": {
            "type": "string",
            "description": "Most frequently accessed registry",
            "example": "entity_registry.json"
          },
          "category_counts": {
            "type": "object",
            "description": "Count of registries by category",
            "properties": {
              "primary": {
                "type": "integer",
                "description": "Number of primary registries",
                "example": 3
              },
              "derived": {
                "type": "integer",
                "description": "Number of derived registries",
                "example": 5
              },
              "configuration": {
                "type": "integer",
                "description": "Number of configuration registries",
                "example": 4
              },
              "metadata": {
                "type": "integer",
                "description": "Number of metadata registries",
                "example": 2
              }
            }
          },
          "update_frequency": {
            "type": "object",
            "description": "Update statistics by registry",
            "patternProperties": {
              "^[a-z0-9_]+\\.json$": {
                "type": "object",
                "properties": {
                  "daily_avg_updates": {
                    "type": "number",
                    "description": "Average daily updates",
                    "example": 2.5
                  },
                  "last_7_days": {
                    "type": "integer",
                    "description": "Updates in last 7 days",
                    "example": 18
                  },
                  "peak_day": {
                    "type": "string",
                    "format": "date",
                    "description": "Day with most updates",
                    "example": "2025-04-25"
                  },
                  "peak_day_count": {
                    "type": "integer",
                    "description": "Updates on peak day",
                    "example": 12
                  }
                }
              }
            }
          }
        }
      },
      "health_metrics": {
        "type": "object",
        "description": "Health metrics for the registry system",
        "properties": {
          "overall_health": {
            "type": "string",
            "enum": ["excellent", "good", "fair", "degraded", "critical"],
            "description": "Overall registry system health",
            "example": "good"
          },
          "validation_status": {
            "type": "object",
            "description": "Validation status summary",
            "properties": {
              "valid_count": {
                "type": "integer",
                "description": "Number of valid registries",
                "example": 12
              },
              "warning_count": {
                "type": "integer",
                "description": "Number of registries with warnings",
                "example": 2
              },
              "invalid_count": {
                "type": "integer",
                "description": "Number of invalid registries",
                "example": 0
              },
              "last_full_validation": {
                "type": "string",
                "format": "date-time",
                "description": "When all registries were last validated",
                "example": "2025-04-29T00:00:00Z"
              }
            }
          },
          "performance_metrics": {
            "type": "object",
            "description": "Registry performance metrics",
            "properties": {
              "avg_load_time_ms": {
                "type": "number",
                "description": "Average registry load time",
                "example": 235.7
              },
              "max_load_time_ms": {
                "type": "number",
                "description": "Maximum registry load time",
                "example": 1250.3
              },
              "slowest_registry": {
                "type": "string",
                "description": "Slowest loading registry",
                "example": "alpha_device_registry.json"
              },
              "total_load_time_ms": {
                "type": "number",
                "description": "Total registry load time",
                "example": 3450.8
              }
            }
          },
          "integrity_metrics": {
            "type": "object",
            "description": "Registry integrity metrics",
            "properties": {
              "cross_reference_errors": {
                "type": "integer",
                "description": "Number of cross-reference errors",
                "example": 0
              },
              "orphaned_references": {
                "type": "integer",
                "description": "Number of orphaned references",
                "example": 2
              },
              "schema_violations": {
                "type": "integer",
                "description": "Number of schema violations",
                "example": 0
              },
              "integrity_score": {
                "type": "integer",
                "minimum": 0,
                "maximum": 100,
                "description": "Overall integrity score (0-100)",
                "example": 98
              }
            }
          },
          "registry_availability": {
            "type": "object",
            "description": "Registry availability metrics",
            "properties": {
              "locked_count": {
                "type": "integer",
                "description": "Number of locked registries",
                "example": 0
              },
              "maintenance_events": {
                "type": "integer",
                "description": "Recent maintenance events",
                "example": 1
              },
              "availability_percentage": {
                "type": "number",
                "minimum": 0,
                "maximum": 100,
                "description": "Registry availability percentage",
                "example": 99.9
              },
              "last_unavailable": {
                "type": "string",
                "format": "date-time",
                "description": "When registries were last unavailable",
                "example": "2025-04-15T02:30:00Z"
              }
            }
          }
        }
      },
      "maintenance_schedule": {
        "type": "array",
        "description": "Scheduled maintenance for registry system",
        "items": {
          "type": "object",
          "properties": {
            "task_id": {
              "type": "string",
              "description": "Unique task identifier",
              "example": "weekly-registry-validation"
            },
            "task_type": {
              "type": "string",
              "enum": ["validation", "backup", "optimization", "migration", "cleanup"],
              "description": "Type of maintenance task",
              "example": "validation"
            },
            "schedule": {
              "type": "string",
              "description": "Schedule in cron format",
              "example": "0 0 * * 0"
            },
            "target_registries": {
              "type": "array",
              "description": "Registries affected by this task",
              "items": {
                "type": "string",
                "example": "all"
              }
            },
            "last_run": {
              "type": "string",
              "format": "date-time",
              "description": "When task was last run",
              "example": "2025-04-28T00:00:00Z"
            },
            "next_run": {
              "type": "string",
              "format": "date-time",
              "description": "When task will next run",
              "example": "2025-05-05T00:00:00Z"
            },
            "last_duration_seconds": {
              "type": "integer",
              "description": "Duration of last run in seconds",
              "example": 345
            },
            "requires_lock": {
              "type": "boolean",
              "description": "Whether task requires registry locks",
              "example": true
            }
          }
        }
      },
      "system_alerts": {
        "type": "array",
        "description": "Active alerts for registry system",
        "items": {
          "type": "object",
          "properties": {
            "alert_id": {
              "type": "string",
              "description": "Unique alert identifier",
              "example": "registry-low-storage"
            },
            "severity": {
              "type": "string",
              "enum": ["critical", "high", "medium", "low", "info"],
              "description": "Alert severity",
              "example": "medium"
            },
            "message": {
              "type": "string",
              "description": "Alert message",
              "example": "Registry storage below 20% free space"
            },
            "affected_components": {
              "type": "array",
              "description": "Components affected by this alert",
              "items": {
                "type": "string",
                "example": "registry_backup_service"
              }
            },
            "first_detected": {
              "type": "string",
              "format": "date-time",
              "description": "When alert was first detected",
              "example": "2025-04-28T18:45:22Z"
            },
            "status": {
              "type": "string",
              "enum": ["new", "acknowledged", "in_progress", "resolved"],
              "description": "Current alert status",
              "example": "acknowledged"
            },
            "resolution_steps": {
              "type": "string",
              "description": "Steps to resolve the alert",
              "example": "Increase available storage or clean up old registry backups"
            }
          }
        }
      }
    },
    "additionalProperties": false
  }