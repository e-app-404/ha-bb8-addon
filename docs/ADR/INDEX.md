# ADR Index

_Generated: 2025-09-21T05:10:24+0000_

| ADR        | Title                                   | Status     | Date       | Author                | Related         | Supersedes         | Last Updated | Token Block | Machine Block |
|------------|-----------------------------------------|------------|------------|-----------------------|-----------------|--------------------|--------------|-------------|--------------|
| [ADR-0001-workspace-topology.md](ADR-0001-workspace-topology.md) | "ADR-0001: Canonical Topology — Dual-Clone via Git Remote (Short)" | Accepted | 2025-08-21 | Promachos Governance | ADR-0003,ADR-0004,ADR-0008,ADR-0009 |  | - | TOKEN_BLOCK: accepted: - WS_READY - DEPLOY_OK - VERIFY_OK - STRUCTURE_OK - SUBTREE_PUBLISH_OK - CLEAN_RUNTIME_OK - RUNTIME_TOPOLOGY_OK drift: - DRIFT: structure_invalid - DRIFT: deploy_failed - DRIFT: runtime_topology_invalid | - |
| [ADR-0002-dependency-policy.md](ADR-0002-dependency-policy.md) | "ADR-0002: Dependency & Runtime Compatibility Policy" | Accepted | 2025-08-22 | Promachos Governance | ADR-0001,ADR-0003 |  | 2025-09-13 | TOKEN_BLOCK: accepted: - DEPENDENCY_POLICY_OK - CALLBACK_API_VERSION_OK drift: - DRIFT: dependency_invalid - DRIFT: callback_api_version_missing | - |
| [ADR-0003-addon-local-build-patterns.md](ADR-0003-addon-local-build-patterns.md) | "ADR-0003: Home Assistant Add-on Local Build & Slug Management" | Accepted | 2025-08-24 | Promachos Governance | ADR-0001,ADR-0002,ADR-0008 |  | 2025-08-24 | TOKEN_BLOCK: accepted: - LOCAL_BUILD_OK - SLUG_MATCH_OK - SUPERVISOR_COMMAND_OK drift: - DRIFT: slug_mismatch - DRIFT: missing_required_files - DRIFT: supervisor_command_failed | - |
| [ADR-0004-runtime-tools-policy.md](ADR-0004-runtime-tools-policy.md) | "ADR-0004: Conditional Runtime Tools Policy (CRTP) & Workspace Drift Enforcement" | Accepted | 2025-08-26 | Strategos | ADR-0001,ADR-0009 |  | 2025-09-13 | TOKEN_BLOCK: accepted: - TOOLS_ALLOWED - SCRIPTS_ALLOWED - STRUCTURE_GUARD_OK drift: - DRIFT: tools_unreferenced_in_dockerfile - DRIFT: scripts_unreferenced_in_dockerfile - DRIFT: structure_guard_failed - name: Structure guard (ADR-0001 + CRTP) run: \| set -euo pipefail test -d addon \|\| (echo addon/ missing && exit 2) if [ -d addon/.git ]; then echo addon is a repo (forbidden); exit 3; fi # Forbidden workspace-only dirs (always) for d in .github docs ops reports addon; do if [ -e addon/$d ]; then echo DRIFT:forbidden_in_addon:$d; exit 4; fi done # Required files + mode test -f addon/config.yaml \|\| (echo DRIFT:missing_config_yaml && exit 5) if rg -n ^\s*image:\s* addon/config.yaml >/dev/null; then echo MODE: PUBLISH rg -n ^\s*version:\s* addon/config.yaml >/dev/null \|\| (echo DRIFT:version_missing_in_publish_mode && exit 7) else echo MODE: LOCAL_DEV test -f addon/Dockerfile \|\| (echo DRIFT:dockerfile_missing_in_local_dev && exit 6) echo TOKEN: DEV_LOCAL_BUILD_FORCED fi # CRTP: tools/ allowed if referenced by Dockerfile or marker present if [ -d addon/tools ]; then if ! grep -Ei (COPY\|ADD\|RUN\|ENTRYPOINT\|CMD).*tools/ addon/Dockerfile >/dev/null 2>&1   && [ ! -f addon/.allow_runtime_tools ]; then echo DRIFT:tools_unreferenced_in_dockerfile; exit 8 else echo TOKEN: TOOLS_ALLOWED fi fi # CRTP: scripts/ allowed if referenced by Dockerfile or marker present if [ -d addon/scripts ]; then if ! grep -Ei (COPY\|ADD\|RUN\|ENTRYPOINT\|CMD).*scripts/ addon/Dockerfile >/dev/null 2>&1   && [ ! -f addon/.allow_runtime_scripts ]; then echo DRIFT:scripts_unreferenced_in_dockerfile; exit 9 else echo TOKEN: SCRIPTS_ALLOWED fi fi echo TOKEN: STRUCTURE_OK CRTP-ALLOW: path: addon/tools/healthcheck.sh reason: container health probe invoked by s6 longrun referenced_by: run.sh:23 safety: shellcheck-clean, no-secrets, bounded-exit owner: pythagoras CRTP-MARKER: file: addon/.allow_runtime_tools entries: - addon/tools/diag_snapshot.sh reason: on-device diagnostics; manual invocation on support safety: shellcheck-clean, ≤100KB, no elevated privileges | - |
| [ADR-0005-development-setup.md](ADR-0005-development-setup.md) | "ADR-0005: Development Setup (legacy)" | Informational | 2025-08-26 | Promachos Governance | ADR-0001 |  | 2025-08-26 | TOKEN_BLOCK: accepted: [] drift: [] | - |
| [ADR-0006-helpers-migration.md](ADR-0006-helpers-migration.md) | "ADR-0006: Helper Functions Migration (legacy)" | Informational | 2025-08-26 | Promachos Governance | ADR-0001 |  | 2025-08-26 | TOKEN_BLOCK: accepted: [] drift: [] | - |
| [ADR-0007-restore-addon.md](ADR-0007-restore-addon.md) | "ADR-0007: Restore add-on working tree into ./addon (Canonical) (legacy)" | Informational | 2025-08-26 | Promachos Governance | ADR-0001 |  | 2025-08-26 | TOKEN_BLOCK: accepted: [] drift: [] | - |
| [ADR-0008-end-to-end-flow.md](ADR-0008-end-to-end-flow.md) | "ADR-0008: End-to-End Development → Deploy Flow (Dual‑Clone & HA Supervisor)" | Accepted | 2025-08-27 | Promachos Governance | ADR-0001,ADR-0003,ADR-0004,(docs/OPERATIONS_OVERVIEW.md) |  | 2025-08-27 | - | - |
| [ADR-0009-adr-governance-formatting.md](ADR-0009-adr-governance-formatting.md) | "ADR-0009: ADR Governance, Redaction, and Formatting Policy" | Draft | 2025-09-13 | Evert Appels, Github Copilot | ADR-0001,ADR-0004,ADR-0008,ADR-0017,ADR-0018 |  | 2025-09-13 | TOKEN_BLOCK: accepted: - ADR_FORMAT_OK - ADR_REDACTION_OK - ADR_GENERATION_OK - TOKEN_BLOCK_OK requires: - ADR_SCHEMA_V1 drift: - DRIFT: adr_format_invalid - DRIFT: missing_token_block - DRIFT: adr_redaction_untracked | - |
| [ADR-0010-unified-supervision-and-diag.md](ADR-0010-unified-supervision-and-diag.md) | "ADR-0010: Unified Supervision & DIAG Instrumentation" | Accepted | 2025-09-03 | Promachos Governance | ADR-0001,ADR-0008 |  | 2025-09-03 | TOKEN_BLOCK: accepted: - DIAG_EVENT_OK - SUPERVISION_OK - HEALTH_HEARTBEAT_OK - CLEAN_RESTART_OK drift: - DRIFT: supervision_failed - DRIFT: diag_event_missing - DRIFT: health_heartbeat_missing | - |
| [ADR-0011-supervisor-only-ops.md](ADR-0011-supervisor-only-ops.md) | "ADR-0011: Supervisor-only Operations" | Accepted | 2025-08-27 | Promachos Governance | ADR-0001,ADR-0010 |  | 2025-09-03 | TOKEN_BLOCK: accepted: - HEALTH_SUMMARY_OK - RUNLOOP_OK - MAIN_PROCESS_STARTED_OK - ECHO_RESPONDER_STARTED_OK - MQTT_CONNECTED_OK drift: - DRIFT: health_summary_missing - DRIFT: runloop_failed - DRIFT: main_process_failed - DRIFT: echo_responder_failed - DRIFT: mqtt_connection_failed | - |
| [ADR-0012-repo-layout-and-imports.md](ADR-0012-repo-layout-and-imports.md) | "ADR-0012: Canonical module layout & imports" | Accepted | 2025-09-05 | Promachos Governance | ADR-0001,ADR-0003,ADR-0009 |  | 2025-09-05 | TOKEN_BLOCK: accepted: - CANONICAL_LAYOUT_OK - IMPORTS_OK - COVERAGE_OK drift: - DRIFT: layout_invalid - DRIFT: imports_invalid - DRIFT: coverage_failed | - |
| [ADR-0013-keep-addon-app.md](ADR-0013-keep-addon-app.md) | "ADR-0013: Keep all app/ scripts and diagnostics in addon/app/" | Accepted | 2025-09-06 | Promachos Governance | ADR-0001,ADR-0012 |  | 2025-09-06 | TOKEN_BLOCK: accepted: - APP_LAYOUT_OK - DIAGNOSTICS_OK drift: - DRIFT: app_layout_invalid - DRIFT: diagnostics_missing | - |
| [ADR-0014-canonical-project-setup.md](ADR-0014-canonical-project-setup.md) | "ADR-0014: Canonical Project Setup for HA-BB8 Addon" | Proposed | 2025-09-11 | Promachos Governance | ADR-0001,ADR-0012,ADR-0013 |  | 2025-09-11 | TOKEN_BLOCK: accepted: - CANONICAL_MAKEFILE_OK - SUPPORTING_FILES_OK - PROJECT_SETUP_OK drift: - DRIFT: makefile_invalid - DRIFT: supporting_files_missing - DRIFT: project_setup_failed | - |
| [ADR-0015-snapshot-and-inventory-policy.md](ADR-0015-snapshot-and-inventory-policy.md) | "ADR-0015: Snapshot & Inventory Policy" | Accepted | 2025-09-12 | Promachos Governance | ADR-0001,ADR-0009 |  | 2025-09-12 | TOKEN_BLOCK: accepted: - SNAPSHOT_POLICY_OK - INVENTORY_OK - THRESHOLDS_OK drift: - DRIFT: snapshot_policy_failed - DRIFT: inventory_missing - DRIFT: thresholds_invalid | - |
| [ADR-0016-coverage-and-seam-policy.md](ADR-0016-coverage-and-seam-policy.md) | "ADR-0016: Coverage & seam policy" | Accepted | 2025-09-12 | Promachos Governance | ADR-0012 |  | 2025-09-12 | TOKEN_BLOCK: accepted: - COVERAGE_POLICY_OK - SEAMS_OK - NETWORK_TESTS_OK drift: - DRIFT: coverage_policy_failed - DRIFT: seams_missing - DRIFT: network_tests_failed | - |
| [ADR-0017-branch-rescue-protocol.md](ADR-0017-branch-rescue-protocol.md) | "ADR-0017: Branch & Rescue Protocol" | Draft | 2025-09-13 | Promachos Governance | ADR-0018,ADR-0009 |  | 2025-09-13 | TOKEN_BLOCK: accepted: - BRANCH_RESCUE_OK - HISTORY_CLEAN_OK drift: - DRIFT: unrelated_history - DRIFT: rescue_without_receipt | MACHINE_BLOCK: type: branch-rescue branch: rescue/20250913_mass_deletion source: origin/main cherry_picks: - commit: abcdef1 - commit: 1234567 receipt: reports/branch_rescue_receipt.txt TOKEN_BLOCK: accepted: - BRANCH_RESCUE_OK - HISTORY_CLEAN_OK drift: - DRIFT: unrelated_history - DRIFT: rescue_without_receipt |
| [ADR-0018-mass-deletion-guard.md](ADR-0018-mass-deletion-guard.md) | "ADR-0018: Mass-Deletion Guard" | Draft | 2025-09-13 | Promachos Governance | ADR-0017,ADR-0009 |  | 2025-09-13 | TOKEN_BLOCK: accepted: - MASS_DELETION_OK - DELETION_RECEIPT_OK drift: - DRIFT: mass_deletion_blocked - DRIFT: missing_deletion_receipt | MACHINE_BLOCK: type: mass-deletion-guard threshold: 30 receipt: reports/mass_deletion_receipt.txt TOKEN_BLOCK: accepted: - MASS_DELETION_OK - DELETION_RECEIPT_OK drift: - DRIFT: mass_deletion_blocked - DRIFT: missing_deletion_receipt |
| [ADR-0019-workspace-folder-taxonomy.md](ADR-0019-workspace-folder-taxonomy.md) | "ADR-0019: Workspace folder taxonomy and assignation rules" | Accepted | 2025-09-14 | Evert Appels, Github Copilot | ADR-0001,ADR-0004,ADR-0008,ADR-0009,ADR-0017,ADR-0018 |  | 2025-09-14 | TOKEN_BLOCK: accepted: - WORKSPACE_TAXONOMY_OK - FOLDER_ASSIGNATION_OK - TOKEN_BLOCK_OK requires: - ADR_SCHEMA_V1 - ADR_FORMAT_OK - ADR_GENERATION_OK - ADR_REDACTION_OK drift: - DRIFT: root_services_d_present - DRIFT: bare_bb8_core_import - DRIFT: python_tools_root - DRIFT: folder_taxonomy_violation | - |
| [ADR-0020-motion-safety-and-mqtt-contract.md](ADR-0020-motion-safety-and-mqtt-contract.md) | "ADR-0020: Workspace folder taxonomy and assignation rules" | Accepted | 2025-09-15 | Evert Appels, Strategos GPT |  |  | 2025-09-15 | - | - |
| [ADR-0021-patch-etiquette.md](ADR-0021-patch-etiquette.md) | "ADR-0021: Patch Etiquette & Session Guidelines" | Accepted | 2025-09-15 | Evert Appels, Strategos GPT |  |  | 2025-09-15 | - | - |
| [ADR-0022-protocol-enforcement.md](ADR-0022-protocol-enforcement.md) | "ADR-0022: Protocol Enforcement (Topics, Imports, Shape)" | Accepted | 2025-09-15 | Evert Appels, Strategos GPT |  |  | 2025-09-15 | - | - |
| [ADR-0023-bb8-integration.md](ADR-0023-bb8-integration.md) | "ADR-0023: BB-8 Integration — Purpose, Constraints, and Runner Governance" | Proposed | 2025-09-20 | Evert Appels | ADR-0001,ADR-0004,ADR-0009,ADR-0012,ADR-0020,ADR-0014 |  | 2025-09-20 | TOKEN_BLOCK: accepted: - ADR_FORMAT_OK - ADR_REDACTION_OK - ADR_GENERATION_OK - TOKEN_BLOCK_OK - BB8_POL_GOVERNANCE_OK - BB8_RUNNER_PLACEMENT_OK requires: - ADR_SCHEMA_V1 drift: - DRIFT: adr_format_invalid - DRIFT: missing_token_block - DRIFT: adr_redaction_untracked - DRIFT: pol_reports_missing | - |
