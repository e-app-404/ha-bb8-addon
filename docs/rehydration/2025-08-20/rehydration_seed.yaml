persona: Strategos
trace:
  label: WS-RESTORE-ADDON-CONSOLIDATION
  id: stp4-ws-restore-2025-08-21T00:00Z-LDN
context:
  timezone: Europe/London
  workspace_root: /Users/evertappels/Projects/HA-BB8
  addon_workspace: /Users/evertappels/Projects/HA-BB8/addon
  addon_runtime: /Volumes/addons/local/beep_boop_bb8
  remote: git@github.com:e-app-404/ha-bb8-addon.git
  report_root: /Users/evertappels/Projects/HA-BB8/reports
  ha_runtime_path_hint: /addons/local/beep_boop_bb8
adr:
  id: ADR-0001
  title: Canonical Topology — Dual-Clone via Git Remote
  decision_date: 2025-08-21
  decision:
    - Workspace: normal Git clone at `HA-BB8/addon`
    - Runtime: clean Git clone at `/Volumes/addons/local/beep_boop_bb8`
    - Deploy: push (workspace) → `git fetch && git reset --hard origin/<branch>` (runtime)
    - Reports: unify to `workspace_root/reports` via `REPORT_ROOT`
guards:
  destructive_ops: false
  placeholders: false
  dry_run_first: true
  abort_on_missing_runtime_scripts: true
acceptance_gate:
  - verify_workspace_heads_match
  - required_runtime_scripts_present
  - reports_dir_exists_and_writable
  - strict_runner_exports_report_root
deliverables_expected:
  - scripts/deploy_to_ha.sh
  - scripts/verify_workspace.sh
  - docs/adr/ADR-0001-workspace-topology.md
  - workspace consolidation completed & verified
output_contract:
  return_lines:
    - WS_READY addon_ws=git_clone_ok runtime=git_clone_ok reports=ok wrappers=ok
    - DEPLOY_OK runtime_head=<short-sha> branch=<name>
    - VERIFY_OK ws_head=<short-sha> runtime_head=<short-sha> remote=<url>
