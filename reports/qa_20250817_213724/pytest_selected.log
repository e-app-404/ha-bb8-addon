
----------------------------- live log collection ------------------------------
INFO     bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:154 discovery_route=scanner reason=ENABLE_BRIDGE_TELEMETRY
WARNING  bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:182 discovery_skip reason=scanner_import_or_call_failed err=cannot import name 'publish_discovery' from partially initialized module 'bb8_core.bb8_presence_scanner' (most likely due to a circular import) (/Volumes/addons/local/beep_boop_bb8/bb8_core/bb8_presence_scanner.py)
INFO     bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     bb8_presence_scanner:bb8_presence_scanner.py:607 BB8Facade not available (cannot import name 'BB8Facade' from partially initialized module 'bb8_core.facade' (most likely due to a circular import) (/Volumes/addons/local/beep_boop_bb8/bb8_core/facade.py)). Commands will be no-ops.
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:655 MQTT dispatcher started.
INFO     venv:ble_link.py:105 BLE link runner started.

tests/test_discovery_publisher.py::test_scanner_discovery_uses_hook_when_set 
-------------------------------- live log call ---------------------------------
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:202 mqtt_host=192.168.0.129 source=env:MQTT_HOST
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:154 discovery_route=scanner reason=ENABLE_BRIDGE_TELEMETRY
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:161 discovery_scanner_called_without_args=true
PASSED                                                                   [  9%]
tests/test_discovery_publisher.py::test_scanner_only_discovery_when_bridge_telemetry_enabled 
-------------------------------- live log call ---------------------------------
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:202 mqtt_host=192.168.0.129 source=env:MQTT_HOST
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:154 discovery_route=scanner reason=ENABLE_BRIDGE_TELEMETRY
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:161 discovery_scanner_called_without_args=true
PASSED                                                                   [ 18%]
tests/test_facade.py::test_sleep_mapping PASSED                          [ 27%]
tests/test_facade.py::test_drive_autostop PASSED                         [ 36%]
tests/test_mqtt_discovery.py::test_gate_on_publishes 
-------------------------------- live log call ---------------------------------
INFO     beep_boop_bb8.bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     beep_boop_bb8.bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     beep_boop_bb8.bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     beep_boop_bb8.bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     beep_boop_bb8.bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:154 discovery_route=scanner reason=ENABLE_BRIDGE_TELEMETRY
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:53 scanner_pub_source=module id=4574411200
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:53 scanner_pub_source=module id=4574411200
INFO     bb8_presence_scanner:bb8_presence_scanner.py:947 Published HA discovery for MAC=AA:BB:CC:DD:EE:FF
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:172 discovery_scanner_called_with_dummy_args=true count=3
INFO     beep_boop_bb8.bb8_core.addon_config:addon_config.py:80 [CONFIG] Loaded YAML config from: /Volumes/addons/local/beep_boop_bb8/config.yaml
INFO     bb8_presence_scanner:bb8_presence_scanner.py:607 BB8Facade not available (cannot import name 'BB8Facade' from partially initialized module 'beep_boop_bb8.bb8_core.facade' (most likely due to a circular import) (/Volumes/addons/local/beep_boop_bb8/bb8_core/facade.py)). Commands will be no-ops.
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:655 MQTT dispatcher started.
INFO     venv:ble_link.py:105 BLE link runner started.
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:300 Published discovery: homeassistant/binary_sensor/bb8_presence/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:301 discovery: published topic=homeassistant/binary_sensor/bb8_presence/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:300 Published discovery: homeassistant/sensor/bb8_rssi/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:301 discovery: published topic=homeassistant/sensor/bb8_rssi/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:300 Published discovery: homeassistant/switch/bb8_power/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:301 discovery: published topic=homeassistant/switch/bb8_power/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:300 Published discovery: homeassistant/number/bb8_heading/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:301 discovery: published topic=homeassistant/number/bb8_heading/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:300 Published discovery: homeassistant/number/bb8_speed/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:301 discovery: published topic=homeassistant/number/bb8_speed/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:300 Published discovery: homeassistant/button/bb8_drive/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:301 discovery: published topic=homeassistant/button/bb8_drive/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:300 Published discovery: homeassistant/button/bb8_sleep/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:301 discovery: published topic=homeassistant/button/bb8_sleep/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:300 Published discovery: homeassistant/light/bb8_led/config
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:301 discovery: published topic=homeassistant/light/bb8_led/config
PASSED                                                                   [ 45%]
tests/test_mqtt_discovery.py::test_idempotency 
-------------------------------- live log call ---------------------------------
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_presence
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_rssi
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_power
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_heading
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_speed
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_drive
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_sleep
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_led
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_presence
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_rssi
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_power
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_heading
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_speed
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_drive
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_sleep
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_led
PASSED                                                                   [ 54%]
tests/test_mqtt_discovery.py::test_force_republish 
-------------------------------- live log call ---------------------------------
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_presence
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_rssi
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_power
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_heading
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_speed
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_drive
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_sleep
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_led
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_presence
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_rssi
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_power
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_heading
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_speed
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_drive
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_sleep
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_led
PASSED                                                                   [ 63%]
tests/test_mqtt_discovery.py::test_json_payload 
-------------------------------- live log call ---------------------------------
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_presence
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_rssi
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_power
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_heading
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_speed
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_drive
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_sleep
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:295 discovery_skip reason=already_published uid=bb8_led
PASSED                                                                   [ 72%]
tests/test_mqtt_discovery.py::test_gate_off 
-------------------------------- live log call ---------------------------------
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:278 discovery_enabled=False source=default
INFO     beep_boop_bb8.bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:279 discovery_skip reason=gate_disabled entity=ALL
PASSED                                                                   [ 81%]
tests/test_mqtt_smoke.py::test_discovery_and_dispatcher_smoke 
-------------------------------- live log call ---------------------------------
INFO     bb8_presence_scanner:bb8_presence_scanner.py:947 Published HA discovery for MAC=testbb8
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:202 mqtt_host=192.168.0.129 source=env:MQTT_HOST
PASSED                                                                   [ 90%]
tests/test_smoke_controller_facade.py::TestSmokeControllerFacade::test_import_and_construct PASSED [100%]
---------------------------- live log sessionfinish ----------------------------
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:154 discovery_route=scanner reason=ENABLE_BRIDGE_TELEMETRY
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:53 scanner_pub_source=module id=4574411200
INFO     bb8_core.mqtt_dispatcher:mqtt_dispatcher.py:178 discovery_skip reason=scanner_publish_requires_args err=publish_discovery() missing 3 required positional arguments: 'client', 'mac', and 'dbus_path'
2025-08-17 21:37:32,182 WARNING:bb8_addon: {'event': 'mqtt_disconnected', 'rc': <MQTTErrorCode.MQTT_ERR_CONN_LOST: 7>}
2025-08-17 21:37:32,182 INFO:bb8_addon: {'event': 'mqtt_connected', 'rc': 0, 'reason': 'success'}


================= 11 passed, 6 deselected, 1 warning in 0.48s ==================
