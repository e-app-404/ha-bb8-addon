#!/usr/bin/env bash
set -euo pipefail
blocked='(^|/)(\.storage/|\.cloud/|tts/|www/|custom_components/|reports/|hestia/diagnostics/|hestia/work/|\.kyb_minmerge/)'
secrets='(\.ssh/|secrets\.yaml|\.git-credentials|\.pem$|\.key$)'
zigbee='(^|/)zigbee2mqtt/(database\.db|state\.json|coordinator_backup\.json)$'

added="$(git diff --cached --name-only --diff-filter=A || true)"
violations="$(printf '%s\n' "$added" | grep -E "$blocked|$secrets|$zigbee" || true)"
if [ -n "$violations" ]; then
  echo "‚ùå Blocked files staged (runtime/sensitive):"
  echo "$violations" | sed 's/^/  - /'
  echo "Edit .gitignore or unstage these files before committing."
  exit 1
fi
exit 0
