# ops/ Workflow Guide\n\n## Development Workflow\n\nComplete development lifecycle using ops/ scripts in logical sequence.\n\n### 1. Environment Setup\n\n```bash\n# Initial workspace setup\nops/workspace/one_shot_setup.sh\n\n# Check workspace health\nops/utils/check_workspace_quiet.sh\n\n# Purge any stray symlinks (if needed)\nops/workspace/symlink_purge.sh\n```\n\n### 2. Development & Testing\n\n```bash\n# Full CI pipeline (compile → test → coverage → gates)\nops/build/compile_test_gate_bleep.sh\n\n# Structure validation\nops/validation/check_structure.sh\n\n# Quality assurance harvest\nops/validation/qa_harvest.py\n\n# Addon verification\nops/validation/verify_addon.sh\n```\n\n### 3. Evidence Collection\n\n```bash\n# Evidence preflight check\nops/evidence/evidence_preflight.sh\n\n# STP4 evidence collection\nops/evidence/run_evidence_stp4.sh\n\n# MQTT probe testing\nops/evidence/mqtt_probe.py\n```\n\n### 4. Release Process\n\n```bash\n# Option A: Using Makefile (recommended)\nmake release-patch    # Automated patch release\nmake release-minor    # Automated minor release  \nmake release-major    # Automated major release\nmake release VERSION=1.2.3  # Specific version\n\n# Option B: Manual step-by-step\nops/release/bump_version.sh patch     # Bump version\nops/release/publish_addon_archive.sh  # Publish to repo\nops/release/deploy_ha_over_ssh.sh     # Deploy to HA\n```\n\n### 5. Deployment Operations\n\n```bash\n# Dual-clone deployment\nops/deploy/deploy_dual_clone.sh\n\n# Workspace deployment\nops/deploy/deploy_workspace.sh\n\n# Runtime canonicalization\nops/deploy/accept_runtime_canonical.sh\n```\n\n### 6. Diagnostics & Troubleshooting\n\n```bash\n# Collect comprehensive diagnostics\nops/diag/collect_ha_bb8_diagnostics.sh home-assistant\n\n# Evidence capture for issues\nops/evidence/capture_trace.py\n\n# Shape guard validation\nops/validation/shape_guard.py\n```\n\n## Architecture Decision Records (ADR)\n\n```bash\n# Generate ADR index\nops/ADR/generate_adr_index.sh\n\n# Validate ADR structure\nops/ADR/validate_adrs.sh\n\n# Cross-repository link validation  \nops/ADR/validate_cross_repo_links.sh\n```\n\n## Script Dependencies\n\n### Dependency Graph\n\n```\nEnvironment Setup (1)\n         ↓\nDevelopment & Testing (2) ←→ Evidence Collection (3)\n         ↓\nRelease Process (4)\n         ↓\nDeployment (5) ←→ Diagnostics (6)\n```\n\n### Prerequisites by Stage\n\n**Environment Setup**\n- Git repository initialized\n- Python virtual environment\n- SSH access configured\n\n**Development & Testing**  \n- Environment setup completed\n- Source code in `addon/` directory\n- Test suite in `addon/tests/`\n\n**Evidence Collection**\n- MQTT broker accessible  \n- BLE hardware available (for full tests)\n- Home Assistant instance reachable\n\n**Release Process**\n- All tests passing\n- Git working directory clean\n- Version files writable\n\n**Deployment**\n- SSH access to target environment\n- Home Assistant API access (LLAT)\n- Target runtime directory accessible\n\n**Diagnostics**\n- SSH access to Home Assistant\n- Addon running or logs accessible\n\n## Integration Points\n\n### Makefile Integration\n\n```makefile\n# Build pipeline\nqa: ops/build/compile_test_gate_bleep.sh\n\n# Validation gates\nvalidate: ops/validation/check_structure.sh && \\\n          ops/validation/verify_addon.sh\n\n# Evidence collection\nevidence-stp4: ops/evidence/run_evidence_stp4.sh\n\n# Release workflow (already implemented)\nrelease-patch: ops/release/bump_version.sh patch && \\\n               ops/release/publish_addon_archive.sh && \\\n               ops/release/deploy_ha_over_ssh.sh\n```\n\n### CI/CD Integration\n\n```yaml\n# .github/workflows/ci.yml (example)\n- name: Build & Test\n  run: ops/build/compile_test_gate_bleep.sh\n  \n- name: Validate Structure  \n  run: ops/validation/check_structure.sh\n  \n- name: Collect Evidence\n  run: ops/evidence/run_evidence_stp4.sh\n  \n- name: Deploy to Staging\n  run: ops/deploy/deploy_workspace.sh staging\n```\n\n## Error Handling\n\n### Exit Code Standards\n\n- **0**: Success - operation completed successfully\n- **1**: Failure - operation failed, user action required  \n- **2**: Error - script execution error, check configuration\n- **3**: Config Error - configuration file or environment issue\n- **64**: Usage Error - incorrect command line arguments\n\n### Common Error Scenarios\n\n**SSH Connection Issues**\n```bash\n# Debug SSH connectivity\nssh -v home-assistant echo \"Connection test\"\n\n# Check SSH config\nops/release/deploy_ha_over_ssh.sh test-llat\n```\n\n**Permission Issues**\n```bash\n# Fix script permissions\nfind ops/ -name \"*.sh\" -exec chmod +x {} \\;\n\n# Check file ownership\nls -la ops/release/\n```\n\n**Environment Issues**\n```bash\n# Verify workspace health\nops/utils/check_workspace_quiet.sh\n\n# Reset workspace if needed\nops/workspace/one_shot_setup.sh --reset\n```\n\n## Best Practices\n\n### Script Development\n\n1. **Test locally first**: Always test scripts in development environment\n2. **Use set -euo pipefail**: Enable strict error handling in bash\n3. **Document usage**: Add clear usage examples in script headers\n4. **Handle edge cases**: Consider failure modes and edge conditions\n5. **Log appropriately**: Balance verbosity with usefulness\n\n### Workflow Management\n\n1. **Follow sequence**: Respect the dependency order in workflows\n2. **Check prerequisites**: Verify environment before running scripts\n3. **Clean working directory**: Ensure git status is clean before releases\n4. **Validate results**: Check script outputs and exit codes\n5. **Monitor logs**: Review operation logs for issues\n\n### Security\n\n1. **No secrets in logs**: Avoid logging sensitive information\n2. **Use SSH keys**: Never use password authentication\n3. **Validate tokens**: Check LLAT presence before API operations\n4. **Principle of least privilege**: Scripts should have minimal required permissions\n\n---\n\n*This workflow documentation supports the complete HA-BB8 addon development, testing, release, and operational lifecycle using the organized ops/ directory structure.*