phases:
  - id: STP1
    label: "Container/BLE (hardware-backed)"
    outputs:
      - "Deterministic startup (no runtime pip-compile)"
      - "BLE adapter probe stable; gateway init OK"
    status: partial
    notes:
      - "BLE actions are safe no-ops; real spherov2 wiring pending"
      - "DBus/AppArmor/host_dbus finalization pending for production"
  - id: STP2
    label: "Logging/Health/Security"
    outputs:
      - "Version probe event (bleak/paho/spherov2) at start"
      - "Secrets redaction: username present; password logged as boolean supplied"
      - "Logging fallback with BB8_LOG_PATH and /tmp fallback (one-time warning)"
      - "Health emit via MQTT ('health':'healthy') after BLE+MQTT up"
    status: complete
    attestation: "STP2/no-secrets: PASS — creds not logged; redaction verified via logs; health event present"
  - id: STP4
    label: "MQTT & HA Discovery (roundtrip)"
    outputs:
      - "Facade-first dispatcher wiring"
      - "Discovery single-shot; profile=extended; entities: presence, rssi, power, stop, led, sleep, drive, heading, speed"
      - "Connect stable (mqtt_connected rc=0)"
    pending:
      - "Per-entity command→state echo ≤2s evidence bundle with timestamps/payloads"
      - "HA schema validation stamp"
    status: in_progress

pending_copilot_instructions:
  - "Wire telemetry loop (presence/RSSI periodic publish)"
  - "Implement spherov2 LED and minimal drive roll; keep try/except guards"
  - "Capture STP4 evidence: ha_mqtt_trace_snapshot"
  - "Finalize build/AppArmor/host_dbus for multi-arch release"
